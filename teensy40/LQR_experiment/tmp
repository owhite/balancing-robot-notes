Weâ€™re continuing work on implementing and tuning the Teensy LQR controller for the inverted pendulum.

The project implements and validates a continuous-time LQR state-space controller on a Teensy 4.0 for an inverted pendulum actuated by a brushless motor via a MESC ESC. All model parameters were originally derived from a CAD-based inertia computation and confirmed in linear and MuJoCo simulations. Real-time control runs at 500 Hz, triggered by CAN feedback from the ESC.

Current Implementation of controller
- On Teensy, run_mode_torque_response() receives sup->esc[0].state.pos_rad (0â€“2Ï€) and sup->esc[0].state.vel_rad_s, computes normalized torque command and clamps to Â±0.5 and transmits it over CAN to the ESC.
- The desired upright equilibrium angle: 4.368 rad.
- Logging collects time (Âµs), torque, position, and velocity and outputs JSON.

Experimental Findings

We know a standard state-space model for a pendulum is this: xË™=Ax+Bu,
- In my model we modeled B=300.
- B may have been wrong. 
- B is how strongly the applied torque affects the angular acceleration
- But we have a contrary physical torque test
- In a physical torque pulse test (0.3 NÂ·m for 250 ms) shows angular acceleration â‰ˆ 25 rad/sÂ² â†’ inferred inertia â‰ˆ 0.012 kgÂ·mÂ². Model inertia was 0.00334 kgÂ·mÂ² â†’ actual actuation â‰ˆ 0.28Ã— as strong as expected. 
- The real value for B (B-real) appears to 84 
- So in our testing the LQR saturates early, producing oscillations and slower-than-predicted response.

The standard state-space model for a pendulum is ğ‘¥-dot =Ax+Bu, where B represents how strongly the applied control input u (torque) affects the pendulumâ€™s angular acceleration. To model ğµ accurately, we need to determine how much actual physical torque the motor produces for a given commanded torque value from the controller. In other words, we must measure the motorâ€™s torque-per-command ratio â€” the mapping between the controllerâ€™s normalized input and the true torque applied at the pendulum joint.

Next Steps
- Recompute ğ¾ based on B-real
- Or scale the existing ğ¾ by â‰ˆ 0.28.
- Verify new closed-loop dynamics and check torque-to-acceleration mapping.
- Gradually increase torque clamp and test stability about 4.368 rad.

